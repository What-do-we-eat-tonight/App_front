import{u as e,G as s,x as t,o as n,c as a,F as i,y as o,a as l,w as u,d as r,b as c,r as _,H as h,v as m,e as d,t as w,i as f,p}from"./index.8f27103f.js";import{_ as g}from"./uni-tag.42261c69.js";import{_ as k,r as y}from"./uni-app.es.117eeecc.js";import{_ as v}from"./uni-icons.414bc032.js";import{_ as b}from"./uni-card.9cdbe16e.js";import{_ as x,a as q}from"./uni-collapse.61d70091.js";import{_ as $}from"./u-button.b4b9cb03.js";var T=k({components:{},data:()=>({ques_avatar:"/static/ques2.png",ans_avatar:"/static/ans2.png",questions:[],new_ans:"",answers:[],like_ques:[],like_ans:[],state:!1,level1:!0,ans_who:"",ans2:"",question_no:0,ans_no:0,is_focus:!1,num:-1,ans_user:-1,timeOutEvent1:0,timeOutEvent2:0}),methods:{comment1(){this.level1=!0,this.ans_who="",this.ans_no=-1},comment2(e,s){this.is_focus=!1,this.level1=!1,this.ans_no=s,this.ans_who=e,console.log(this.level1),this.$nextTick((()=>{this.is_focus=!0}))},async send(){let s={};this.level1?(s={question_no:e("q_num"),answer:this.new_ans,user_id:e("login_id")},console.log(s),await this.$u.post("student_user/answer1",s),this.$u.toast("发送成功")):(s={answer_no:this.ans_no,answer:this.ans2,user_id:e("login_id"),answer_who:this.ans_who},console.log(s),await this.$u.post("student_user/answer2",s),this.$u.toast("发送成功")),this.getAnswers(),this.new_ans=""},async getQuestions(){await this.$u.post("student_user/GetQuestion",{cno:"COMP1221"}).then((e=>{this.questions=e,this.like_ques.push({})})),console.log(this.questions);let e=0;for(var s in this.questions){console.log(s);let t={question_num1:this.questions[e].q_id};console.log(t),await this.$u.post("student_user/getanswer",t).then((e=>{this.answers1.push(e),this.like_ans.push(!1),console.log(e)})),e++}console.log(this.questions)},async like_it1(s,t){this.answers[t].hasliked=!0,this.answers[t].like_num++,this.answers[t].teacher_like=!0;let n={sequence_num:s,tno:e("login_id")};console.log(n),await this.$u.post("teacher_user/answer_thumbs",n),this.$u.toast("点赞成功")},async like_it2(s,t,n){this.answers[t].answer2s[n].hasliked=!0,this.answers[t].answer2s[n].like_num++,this.answers[t].answer2s[n].teacher_like=!0;let a={sequence_num:s,tno:e("login_id")};await this.$u.post("teacher_user/answer2_thumbs",a),this.$u.toast("点赞成功")},async dislike_it1(s,t){this.answers[t].hasliked=!1,this.answers[t].like_num--;let n={sequence_num:s,tno:e("login_id")};await this.$u.post("teacher_user/answer_thumbs_cancel",n),this.$u.toast("取消点赞成功")},async dislike_it2(s,t,n){this.answers[t].answer2s[n].hasliked=!1,this.answers[t].answer2s[n].like_num--;let a={sequence_num:s,tno:e("login_id")};await this.$u.post("teacher_user/answer2_thumbs_cancel",a),this.$u.toast("取消点赞成功")},async getAnswers(){let s={question_num1:e("q_num"),user_id:e("login_id")};console.log(s),await this.$u.post("student_user/getanswer",s).then((e=>{this.answers=e})),console.log(this.answers)},gtouchstart(e,s){var t=this;return this.timeOutEvent1=setTimeout((function(){t.longPress(e,s)}),500),!1},showDeleteButton(e){return clearTimeout(this.timeOutEvent1),0!=this.timeOutEvent1&&console.log("点击但未长按"),!1},gtouchmove(){clearTimeout(this.timeOutEvent1),this.timeOutEvent1=0},async longPress(e,t){this.timeOutEvent1=0;var n=this;n.num=e,n.ans_user=t,console.log(n.num),s({title:"确认删除回答",content:"请确认是否删除这条回答",success:async function(e){if(e.confirm){let e={answer_no1:n.num};console.log(e),await n.$u.post("student_user/del_answer1",e),n.$u.toast("删除成功")}else e.cancel}})},gtouchstart2(e,s){var t=this;return this.timeOutEvent2=setTimeout((function(){t.longPress2(e,s)}),500),!1},showDeleteButton2(e){return clearTimeout(this.timeOutEvent2),0!=this.timeOutEvent2&&console.log("点击但未长按"),!1},gtouchmove2(){clearTimeout(this.timeOutEvent2),this.timeOutEvent2=0},async longPress2(e,t){this.timeOutEvent=0;var n=this;n.num=e,n.ans_user=t,console.log(n.num),s({title:"确认删除回复",content:"请确认是否删除这条回复",success:async function(e){if(e.confirm){let e={answer_no2:n.num};console.log(e),await n.$u.post("student_user/del_answer2",e),n.$u.toast("删除成功")}else e.cancel}})}},onLoad(){this.getAnswers()},onBackPress(){console.log("yesyesyes")},onPullDownRefresh(){console.log("refresh"),this.getAnswers(),setTimeout((function(){t()}),1e3)}},[["render",function(e,s,t,k,T,C){const O=y(_("uni-tag"),g),E=f,j=p,P=y(_("uni-icons"),v),z=y(_("uni-card"),b),B=h("uni-list"),V=y(_("uni-collapse-item"),x),D=y(_("uni-collapse"),q),A=m,G=y(_("u-button"),$);return n(),a(i,null,[(n(!0),a(i,null,o(T.answers,((e,t)=>(n(),r(D,null,{default:u((()=>[l(V,{titleBorder:"none"},{title:u((()=>[l(B,null,{default:u((()=>[l(z,{title:e.user_name+" 回答","sub-title":e.user_id,extra:e.answer_time,thumbnail:T.ans_avatar,onTouchstart:s=>C.gtouchstart(e.answer_num,e.user_id),onTouchmove:s[0]||(s[0]=e=>C.gtouchmove()),onTouchend:s=>C.showDeleteButton(e.answer_num,e.user_id)},{default:u((()=>[l(E,{class:"tag-view",style:{"margin-bottom":"5px","margin-top":"0px","margin-left":"5px"}},{default:u((()=>[e.teacher_like?(n(),r(O,{key:0,text:"老师赞过",type:"error",circle:!0})):d("",!0)])),_:2},1024),l(j,{class:"uni-body"},{default:u((()=>[c(w(e.answer),1)])),_:2},1024),l(E,{slot:"actions",class:"card-actions"},{default:u((()=>[l(E,{class:"card-actions-item"},{default:u((()=>[e.hasliked?(n(),r(P,{key:1,type:"heart-filled",size:"18",color:"#ff0000",onClick:s=>C.dislike_it1(e.answer_num,t)},null,8,["onClick"])):(n(),r(P,{key:0,type:"heart",size:"18",color:"#999",onClick:s=>C.like_it1(e.answer_num,t)},null,8,["onClick"])),l(j,{class:"card-actions-item-text"},{default:u((()=>[c(w(e.like_num),1)])),_:2},1024)])),_:2},1024),l(E,{class:"card-actions-item",onClick:s=>C.comment2(e.user_name,e.answer_num)},{default:u((()=>[l(P,{type:"chatbubble",size:"18",color:"#999"}),l(j,{class:"card-actions-item-text"},{default:u((()=>[c("评论("+w(e.len)+")",1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","sub-title","extra","thumbnail","onTouchstart","onTouchend"])])),_:2},1024)])),default:u((()=>[(n(!0),a(i,null,o(e.answer2s,((a,i)=>(n(),r(E,{class:"content",style:{"margin-top":"0px","margin-bottom":"0px"}},{default:u((()=>[l(z,{title:a.user_name,"sub-title":a.user_id,extra:a.answer_time,onTouchstart:e=>C.gtouchstart2(a.answer_num,a.user_id),onTouchmove:s[1]||(s[1]=e=>C.gtouchmove2()),onTouchend:e=>C.showDeleteButton2(a.answer_num,a.user_id)},{default:u((()=>[l(E,{class:"tag-view",style:{"margin-bottom":"5px","margin-top":"0px","margin-left":"5px"}},{default:u((()=>[a.teacher_like?(n(),r(O,{key:0,text:"老师赞过",type:"error",circle:!0})):d("",!0)])),_:2},1024),l(j,{class:"uni-body"},{default:u((()=>[c(w(a.answer),1)])),_:2},1024),l(E,{slot:"actions",class:"card-actions"},{default:u((()=>[l(E,{class:"card-actions-item"},{default:u((()=>[a.hasliked?(n(),r(P,{key:1,type:"heart-filled",size:"18",color:"#ff0000",onClick:e=>C.dislike_it2(a.answer_num,t,i)},null,8,["onClick"])):(n(),r(P,{key:0,type:"heart",size:"18",color:"#999",onClick:e=>C.like_it2(a.answer_num,t,i)},null,8,["onClick"])),l(j,{class:"card-actions-item-text"},{default:u((()=>[c(w(a.like_num),1)])),_:2},1024)])),_:2},1024),l(E,{class:"card-actions-item",onClick:s=>C.comment2(a.user_name,e.answer_num)},{default:u((()=>[l(P,{type:"chatbubble",size:"18",color:"#999"}),l(j,{class:"card-actions-item-text"},{default:u((()=>[c("评论")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","sub-title","extra","onTouchstart","onTouchend"])])),_:2},1024)))),256))])),_:2},1024)])),_:2},1024)))),256)),l(z,null,{default:u((()=>[T.level1?(n(),r(A,{key:0,style:{height:"50px"},modelValue:T.new_ans,"onUpdate:modelValue":s[2]||(s[2]=e=>T.new_ans=e),ref:"myinput",focus:"",placeholder:"我也要写回答...."},null,8,["modelValue"])):(n(),r(A,{key:1,style:{height:"50px"},modelValue:T.ans2,"onUpdate:modelValue":s[3]||(s[3]=e=>T.ans2=e),ref:"myinput",focus:T.is_focus,placeholder:"回复:"+T.ans_who},null,8,["modelValue","focus","placeholder"])),l(G,{onClick:C.send,type:"primary"},{default:u((()=>[c("发送")])),_:1},8,["onClick"])])),_:1})],64)}],["__scopeId","data-v-7149b77f"]]);export{T as default};
