import{u as s,G as e,x as t,o as n,c as o,F as i,y as a,a as l,w as u,d as r,b as c,r as _,H as h,v as m,e as d,t as w,i as g,p as f}from"./index.8f27103f.js";import{_ as p}from"./uni-tag.42261c69.js";import{_ as k,r as y}from"./uni-app.es.117eeecc.js";import{_ as v}from"./uni-icons.414bc032.js";import{_ as b}from"./uni-card.9cdbe16e.js";import{_ as x,a as $}from"./uni-collapse.61d70091.js";import{_ as q}from"./u-button.b4b9cb03.js";var T=k({components:{},data:()=>({ques_avatar:"/static/ques2.png",ans_avatar:"/static/ans2.png",questions:[],new_ans:"",answers:[],like_ques:[],like_ans:[],state:!1,level1:!0,ans_who:"",ans2:"",question_no:0,ans_no:0,is_focus:!1,num:-1,ans_user:-1,timeOutEvent1:0,timeOutEvent2:0}),methods:{comment1(){this.level1=!0,this.ans_who="",this.ans_no=-1},async comment2(s,e){this.is_focus=!1,this.level1=!1,this.ans_no=e,this.ans_who=s,console.log(this.level1),this.$nextTick((()=>{this.is_focus=!0}))},async send(){let e={};this.level1?(e={question_no:s("q_num"),answer:this.new_ans,user_id:s("login_id")},console.log(e),await this.$u.post("student_user/answer1",e),this.$u.toast("发送成功")):(e={answer_no:this.ans_no,answer:this.ans2,user_id:s("login_id"),answer_who:this.ans_who},console.log(e),await this.$u.post("student_user/answer2",e),this.$u.toast("发送成功")),this.new_ans="",this.getAnswers()},async getQuestions(){await this.$u.post("student_user/GetQuestion",{cno:"COMP1221"}).then((s=>{this.questions=s,this.like_ques.push({})})),console.log(this.questions);let s=0;for(var e in this.questions){console.log(e);let t={question_num1:this.questions[s].q_id};console.log(t),await this.$u.post("student_user/getanswer",t).then((s=>{this.answers1.push(s),this.like_ans.push(!1),console.log(s)})),s++}console.log(this.questions)},async like_it1(e,t){this.answers[t].hasliked=!0,this.answers[t].like_num++;let n={sequence_num:e,sno:s("login_id")};console.log(n),await this.$u.post("student_user/answer_thumbs",n),this.$u.toast("点赞成功")},async like_it2(e,t,n){this.answers[t].answer2s[n].hasliked=!0,this.answers[t].answer2s[n].like_num++;let o={sequence_num:e,sno:s("login_id")};await this.$u.post("student_user/answer2_thumbs",o),this.$u.toast("点赞成功")},async dislike_it1(e,t){this.answers[t].hasliked=!1,this.answers[t].like_num--;let n={sequence_num:e,tno:s("login_id")};await this.$u.post("student_user/answer_thumbs_cancel",n),this.$u.toast("取消点赞成功")},async dislike_it2(e,t,n){this.answers[t].answer2s[n].hasliked=!1,this.answers[t].answer2s[n].like_num--;let o={sequence_num:e,tno:s("login_id")};await this.$u.post("student_user/answer2_thumbs_cancel",o),this.$u.toast("取消点赞成功")},async getAnswers(){let e={question_num1:s("q_num"),user_id:s("login_id")};console.log(e),await this.$u.post("student_user/getanswer",e).then((s=>{this.answers=s})),console.log(this.answers)},gtouchstart(s,e){var t=this;return this.timeOutEvent1=setTimeout((function(){t.longPress(s,e)}),500),!1},showDeleteButton(s){return clearTimeout(this.timeOutEvent1),0!=this.timeOutEvent1&&console.log("点击但未长按"),!1},gtouchmove(){clearTimeout(this.timeOutEvent1),this.timeOutEvent1=0},async longPress(t,n){this.timeOutEvent1=0;var o=this;o.num=t,o.ans_user=n,console.log(o.num),e({title:"确认删除回答",content:"请确认是否删除这条回答",success:async function(e){if(e.confirm)if(s("login_id")!=o.ans_user)console.log(s("login_id")),console.log(o.ans_user),console.log(s("login_id")==o.ans_user),o.$u.toast("你无权删除");else{let s={answer_no1:o.num};console.log(s),await o.$u.post("student_user/del_answer1",s),o.$u.toast("删除成功")}else e.cancel}})},gtouchstart2(s,e){var t=this;return this.timeOutEvent2=setTimeout((function(){t.longPress2(s,e)}),500),!1},showDeleteButton2(s){return clearTimeout(this.timeOutEvent2),0!=this.timeOutEvent2&&console.log("点击但未长按"),!1},gtouchmove2(){clearTimeout(this.timeOutEvent2),this.timeOutEvent2=0},async longPress2(t,n){this.timeOutEvent=0;var o=this;o.num=t,o.ans_user=n,console.log(o.num),e({title:"确认删除回复",content:"请确认是否删除这条回复",success:async function(e){if(e.confirm)if(s("login_id")!=o.ans_user)console.log(s("login_id")),console.log(o.ans_user),o.$u.toast("你无权删除");else{let s={answer_no2:o.num};console.log(s),await o.$u.post("student_user/del_answer2",s),o.$u.toast("删除成功")}else e.cancel}})}},onLoad(){this.getAnswers()},onPullDownRefresh(){console.log("refresh"),this.getAnswers(),setTimeout((function(){t()}),1e3)}},[["render",function(s,e,t,k,T,C){const O=y(_("uni-tag"),p),E=g,j=f,z=y(_("uni-icons"),v),P=y(_("uni-card"),b),V=h("uni-list"),B=y(_("uni-collapse-item"),x),D=y(_("uni-collapse"),$),A=m,G=y(_("u-button"),q);return n(),o(i,null,[(n(!0),o(i,null,a(T.answers,((s,t)=>(n(),r(D,{style:{"margin-bottom":"5px"}},{default:u((()=>[l(B,{titleBorder:"none"},{title:u((()=>[l(V,null,{default:u((()=>[l(P,{title:s.user_name+" 回答","sub-title":s.user_id,extra:s.answer_time,thumbnail:T.ans_avatar,onTouchstart:e=>C.gtouchstart(s.answer_num,s.user_id),onTouchmove:e[0]||(e[0]=s=>C.gtouchmove()),onTouchend:e=>C.showDeleteButton(s.answer_num,s.user_id)},{default:u((()=>[l(E,{class:"tag-view",style:{"margin-bottom":"5px","margin-top":"5px","margin-left":"5px"}},{default:u((()=>[s.teacher_like?(n(),r(O,{key:0,text:"老师赞过",type:"error",circle:!0})):d("",!0)])),_:2},1024),l(j,{class:"uni-body"},{default:u((()=>[c(w(s.answer),1)])),_:2},1024),l(E,{slot:"actions",class:"card-actions"},{default:u((()=>[l(E,{class:"card-actions-item"},{default:u((()=>[s.hasliked?(n(),r(z,{key:1,type:"heart-filled",size:"18",color:"#ff0000",onClick:e=>C.dislike_it1(s.answer_num,t)},null,8,["onClick"])):(n(),r(z,{key:0,type:"heart",size:"18",color:"#999",onClick:e=>C.like_it1(s.answer_num,t)},null,8,["onClick"])),l(j,{class:"card-actions-item-text"},{default:u((()=>[c(w(s.like_num),1)])),_:2},1024)])),_:2},1024),l(E,{class:"card-actions-item",onClick:e=>C.comment2(s.user_name,s.answer_num)},{default:u((()=>[l(z,{type:"chatbubble",size:"18",color:"#999"}),l(j,{class:"card-actions-item-text"},{default:u((()=>[c("评论("+w(s.len)+")",1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","sub-title","extra","thumbnail","onTouchstart","onTouchend"])])),_:2},1024)])),default:u((()=>[(n(!0),o(i,null,a(s.answer2s,((o,i)=>(n(),r(E,{class:"content",style:{"margin-top":"5px","margin-bottom":"5px"}},{default:u((()=>[l(P,{title:o.user_name,"sub-title":o.user_id,extra:o.answer_time,onTouchstart:s=>C.gtouchstart2(o.answer_num,o.user_id),onTouchmove:e[1]||(e[1]=s=>C.gtouchmove2()),onTouchend:s=>C.showDeleteButton2(o.answer_num,o.user_id)},{default:u((()=>[l(E,{class:"tag-view",style:{"margin-bottom":"5px","margin-top":"5px","margin-left":"5px"}},{default:u((()=>[o.teacher_like?(n(),r(O,{key:0,text:"老师赞过",type:"error",circle:!0})):d("",!0)])),_:2},1024),l(j,{class:"uni-body"},{default:u((()=>[c(w(o.answer),1)])),_:2},1024),l(E,{slot:"actions",class:"card-actions"},{default:u((()=>[l(E,{class:"card-actions-item"},{default:u((()=>[o.hasliked?(n(),r(z,{key:1,type:"heart-filled",size:"18",color:"#ff0000",onClick:s=>C.dislike_it2(o.answer_num,t,i)},null,8,["onClick"])):(n(),r(z,{key:0,type:"heart",size:"18",color:"#999",onClick:s=>C.like_it2(o.answer_num,t,i)},null,8,["onClick"])),l(j,{class:"card-actions-item-text"},{default:u((()=>[c(w(o.like_num),1)])),_:2},1024)])),_:2},1024),l(E,{class:"card-actions-item",onClick:e=>C.comment2(o.user_name,s.answer_num)},{default:u((()=>[l(z,{type:"chatbubble",size:"18",color:"#999"}),l(j,{class:"card-actions-item-text"},{default:u((()=>[c("评论")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","sub-title","extra","onTouchstart","onTouchend"])])),_:2},1024)))),256))])),_:2},1024)])),_:2},1024)))),256)),l(P,null,{default:u((()=>[T.level1?(n(),r(A,{key:0,style:{height:"50px"},modelValue:T.new_ans,"onUpdate:modelValue":e[2]||(e[2]=s=>T.new_ans=s),ref:"myinput",placeholder:"我也要写回答...."},null,8,["modelValue"])):(n(),r(A,{key:1,id:"myinput2",style:{height:"50px"},modelValue:T.ans2,"onUpdate:modelValue":e[3]||(e[3]=s=>T.ans2=s),focus:T.is_focus,ref:"myinput2",placeholder:"回复:"+T.ans_who},null,8,["modelValue","focus","placeholder"])),l(G,{onClick:C.send,type:"primary"},{default:u((()=>[c("发送")])),_:1},8,["onClick"])])),_:1})],64)}],["__scopeId","data-v-5fcc5938"]]);export{T as default};
